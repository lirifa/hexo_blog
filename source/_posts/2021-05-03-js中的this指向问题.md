---
title: jsä¸­çš„thisæŒ‡å‘é—®é¢˜
date: 2021-05-03 11:34:34
updated: 2021-05-03 16:23:33
tags: [å‰ç«¯, js]
categories: æŠ€æœ¯
---
ç»“è®ºï¼š<font color="#dd0000">thisçš„å€¼å–å†³äºå‡½æ•°æ˜¯æ€ä¹ˆè¢«è°ƒç”¨çš„ã€‚</font>
<!-- more -->

# èƒŒæ™¯çŸ¥è¯† â€”â€” JS çš„æ‰§è¡Œæ¨¡å‹ä¸ä½œç”¨åŸŸæœºåˆ¶
**ä»£ç æ‰§è¡Œçš„ä¸‰ä¸ªé˜¶æ®µ**
ç¼–è¯‘é˜¶æ®µ -> åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡ -> æ‰§è¡Œé˜¶æ®µ

| é˜¶æ®µ           | ä¸»è¦ä½œç”¨                            | ä¸ this çš„å…³ç³»            |
| -------------- | ----------------------------------- | ------------------------- |
| ç¼–è¯‘é˜¶æ®µ       | è¯æ³•åˆ†æã€ä½œç”¨åŸŸæ”¶é›†ã€å˜é‡/å‡½æ•°æå‡ | this ä¸å‚ä¸               |
| åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡ | æ„å»ºå˜é‡ç¯å¢ƒå’Œè¯æ³•ç¯å¢ƒ              | this æœªç»‘å®š               |
| æ‰§è¡Œé˜¶æ®µ       | é€è¡Œæ‰§è¡Œè¯­å¥ã€å‡½æ•°è°ƒç”¨ã€è¡¨è¾¾å¼æ±‚å€¼  | this æ ¹æ®è°ƒç”¨æ–¹å¼åŠ¨æ€ç»‘å®š |

this å’Œå˜é‡æŸ¥æ‰¾æ˜¯ä¸¤ç äº‹ï¼
- è‡ªç”±å˜é‡æŸ¥æ‰¾ï¼šæ²¿ç€ä½œç”¨åŸŸé“¾å‘ä¸ŠæŸ¥æ‰¾ï¼ˆç¼–è¯‘æ—¶ç¡®å®šï¼‰
- this æŸ¥æ‰¾ï¼šå–å†³äºå‡½æ•°å¦‚ä½•è¢«è°ƒç”¨ï¼ˆè¿è¡Œæ—¶å†³å®šï¼‰
| æœºåˆ¶                  | æŸ¥æ‰¾ä»€ä¹ˆï¼Ÿ | ä½•æ—¶ç¡®å®šï¼Ÿ             | ç”±ä»€ä¹ˆå†³å®šï¼Ÿ                 |
| --------------------- | ---------- | ---------------------- | ---------------------------- |
| è‡ªç”±å˜é‡ï¼ˆå¦‚ myNameï¼‰ | å˜é‡çš„å€¼   | ç¼–è¯‘é˜¶æ®µï¼ˆä»£ç è§£ææ—¶ï¼‰ | å‡½æ•°å®šä¹‰çš„ä½ç½®ï¼ˆè¯æ³•ä½œç”¨åŸŸï¼‰ |
| this                  | ä¸Šä¸‹æ–‡å¯¹è±¡ | è¿è¡Œé˜¶æ®µï¼ˆå‡½æ•°è°ƒç”¨æ—¶ï¼‰ | å‡½æ•°çš„è°ƒç”¨æ–¹å¼               |

# this çš„ç»‘å®šè§„åˆ™
è®°ä½è¿™ä¸ªå£è¯€ ğŸ‘‡
> â€œçœ‹è°ƒç”¨ï¼Œä¸çœ‹å®šä¹‰ï¼›è°è°ƒç”¨ï¼Œthis å°±æ˜¯è°ï¼â€

##  é»˜è®¤ç»‘å®šï¼šæ™®é€šå‡½æ•°è°ƒç”¨ â†’ this = å…¨å±€å¯¹è±¡
```js
function foo() {
  console.log(this);
}
foo(); // æµè§ˆå™¨ä¸­ â†’ windowï¼ˆéä¸¥æ ¼æ¨¡å¼ï¼‰ï¼›ä¸¥æ ¼æ¨¡å¼ â†’ undefined
```
- é—®é¢˜ï¼šå®¹æ˜“æ„å¤–æ±¡æŸ“å…¨å±€ï¼ˆå°¤å…¶ç”¨ var æ—¶ï¼Œå˜é‡ä¼šæŒ‚åˆ° window ä¸Šï¼‰
- å»ºè®®ï¼šå§‹ç»ˆä½¿ç”¨ 'use strict'ï¼Œè®©é”™è¯¯æå‰æš´éœ²ï¼ä½¿ç”¨ let å£°æ˜ å˜é‡ä¸ä¼šæŒ‚åˆ°window ä¸Š

## éšå¼ç»‘å®šï¼šä½œä¸ºå¯¹è±¡æ–¹æ³•è°ƒç”¨ â†’ this = å¯¹è±¡æœ¬èº«
```js
const user = {
  name: 'rafa',
  greet() {
    console.log(`Hello, ${this.name}`);
  }
};
user.greet(); // â†’ "Hello, rafa"
// å…¶å®æ™®é€šå‡½æ•°è°ƒç”¨è·Ÿå¯¹è±¡æ–¹æ³•è°ƒç”¨æ˜¯ä¸€å›äº‹
// å…¨å±€å‡½æ•°å£°æ˜åä¼šæŒ‚åœ¨ window ä¸‹é¢ï¼Œæˆä¸ºwindowçš„ä¸€ä¸ªæ–¹æ³•
function rafa() {
    console.log('my name is rafa')
}
window.rafa() // "my name is rafa"
rafa() // "my name is rafa"
console.log(window.rafa === rafa)  // true
```
- è§„åˆ™ï¼šç‚¹ï¼ˆ.ï¼‰å‰é¢æ˜¯è°ï¼Œthis å°±æ˜¯è°
- è­¦æƒ•â€œæ–¹æ³•ä¸¢å¤±â€ï¼š
```js
const sayHi = user.greet;
sayHi(); // this = window â†’ "Hello, undefined"
```

## æ˜¾å¼ç»‘å®šï¼šç”¨ call / apply / bind å¼ºåˆ¶æŒ‡å®š this
```js
let bar = { myName: 'rafa' };
function updateName() {
  this.myName = 'hexo';
}
updateName.call(bar); // å¼ºåˆ¶ this = bar
console.log(bar.myName); // â†’ 'hexo'
```
- è¿™æ˜¯ä¿®å¤â€œæ–¹æ³•ä¸¢å¤±â€çš„ç»ˆææ­¦å™¨ï¼
- bind è¿˜èƒ½åˆ›å»ºæ°¸ä¹…ç»‘å®šçš„æ–°å‡½æ•°ã€‚

## new ç»‘å®šï¼šæ„é€ å‡½æ•°è°ƒç”¨ â†’ this = æ–°åˆ›å»ºçš„å®ä¾‹
```js
function Person(name) {
  this.name = name; // this æŒ‡å‘å³å°†è¿”å›çš„æ–°å¯¹è±¡
}
const p = new Person('å°æ˜');
console.log(p.name); // â†’ 'å°æ˜'
```
- ä½¿ç”¨ new æ—¶ï¼ŒJS ä¼šè‡ªåŠ¨ï¼š
    1. åˆ›å»ºç©ºå¯¹è±¡
    2. ç»‘å®š this åˆ°è¯¥å¯¹è±¡
    3. æ‰§è¡Œå‡½æ•°ä½“
    4. è¿”å›å¯¹è±¡
   
## äº‹ä»¶å¤„ç†å‡½æ•°ï¼šthis = è§¦å‘äº‹ä»¶çš„ DOM å…ƒç´ 
```js
<button id="btn">ç‚¹æˆ‘</button>
<script>
document.getElementById('btn').addEventListener('click', function() {
  console.log(this); // â†’ <button id="btn"> å…ƒç´ 
});
</script>
```
- æµè§ˆå™¨è‡ªåŠ¨å°† this ç»‘å®šåˆ°äº‹ä»¶ç›®æ ‡å…ƒç´ ï¼Œéå¸¸æ–¹ä¾¿ï¼

## ç®­å¤´å‡½æ•°ä¸­çš„this
ç®­å¤´å‡½æ•°ä¸ç»‘å®š thisï¼Œè€Œæ˜¯ç»§æ‰¿å¤–å±‚è¯æ³•ä½œç”¨åŸŸçš„ this
```js
const obj = {
  name: 'Bob',
  foo() {
    setTimeout(() => {
      console.log(this.name); // "Bob"
    }, 100);
  }
};
```

## ç»‘å®šä¼˜å…ˆçº§æ€»ç»“ï¼š
**new > call/apply/bind > å¯¹è±¡æ–¹æ³• > æ™®é€šå‡½æ•°**

## ä¸ºä»€ä¹ˆ this è®¾è®¡å¾—è¿™ä¹ˆâ€œå¥‡æ€ªâ€ï¼Ÿ

JavaScript çš„ this å¸¸è¢«åæ§½ï¼ŒåŸå› æœ‰ä¸‰ï¼š
1. å†å²åŒ…è¢±ï¼šæ—©æœŸæ²¡æœ‰ç±»ï¼Œé å‡½æ•°æ¨¡æ‹Ÿ OOPï¼Œthis æˆäº†â€œä¸‡èƒ½èƒ¶æ°´â€
2. é»˜è®¤æŒ‡å‘ windowï¼šå¯¼è‡´å…¨å±€æ±¡æŸ“ï¼ˆvar a = 1 â†’ window.a = 1ï¼‰
3. åŠ¨æ€ç»‘å®š vs é™æ€ä½œç”¨åŸŸï¼šä¸ JS å…¶ä»–éƒ¨åˆ†çš„è®¾è®¡å“²å­¦å†²çª

å½“ç„¶ï¼Œè¿™ç§è®¾è®¡ä¹Ÿæœ‰ä¼˜ç‚¹ï¼š
1. æ–¹æ³•å¯ä»¥è¢«å¤šä¸ªå¯¹è±¡å¤ç”¨ï¼ˆé€šç”¨å·¥å…·å‡½æ•°ï¼‰
2. æ”¯æŒå¼ºå¤§çš„â€œæ–¹æ³•å€Ÿç”¨â€ï¼ˆå¦‚ Array.prototype.slice.call(arguments)ï¼‰
   
> ğŸŒˆ ES6 çš„ç®­å¤´å‡½æ•°æ­£æ˜¯ä¸ºè§£å†³ this å›°æƒ‘è€Œç”Ÿï¼š
ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ thisï¼Œå®ƒç»§æ‰¿å¤–å±‚ä½œç”¨åŸŸçš„ thisã€‚

##  ç»ˆææ€»ç»“ï¼šä¸€å¼ è¡¨æå®š this
| è°ƒç”¨æ–¹å¼              | this æŒ‡å‘                       | ç¤ºä¾‹                |
| --------------------- | ------------------------------- | ------------------- |
| æ™®é€šè°ƒç”¨ fn()         | å…¨å±€å¯¹è±¡ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼šundefinedï¼‰ | foo()               |
| å¯¹è±¡æ–¹æ³• obj.fn()     | obj                             | user.getName()      |
| æ˜¾å¼ç»‘å®š fn.call(obj) | obj                             | greet.call(person)  |
| æ„é€ å‡½æ•° new Fn()     | æ–°åˆ›å»ºçš„å®ä¾‹                    | new Date()          |
| äº‹ä»¶å›è°ƒ              | è§¦å‘äº‹ä»¶çš„ DOM å…ƒç´              | button.onclick = fn |
**ç‰¢è®°ä¸‰å¥è¯ï¼š**
1. å˜é‡æŸ¥æ‰¾çœ‹â€œå‡ºç”Ÿåœ°â€ï¼Œthis æŸ¥çœ‹â€œè°å«ä½ â€
2. let/const ä¸æŒ‚ windowï¼Œvar ä¼šæŒ‚window â€”â€” å°‘ç”¨ varï¼
3. å¼€å¯ 'use strict'ï¼Œè®©é”™è¯¯æ— å¤„è—èº«